---
title: "SuperBowl Ads"
author: "Dorian's Gs <br> Martha Aboagye, Parker Dingman, Eli Feder, Courtney Lee"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css:  xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
library(ggplot2)
library(tidyverse)
library(tidymodels)
library(knitr)
library(xaringanthemer)
library(fs)
library(dplyr)
library(ggridges)
library(forcats)
library(scales)
library(colorspace)
library(ggrepel)
library(cowplot)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  #fig.retina = 3, 
  #dpi = 300, 
  fig.width = 30, 
  fig.height = 17,
  fig.align = "center"
  #fig.asp = 0.618
  )
```

```{r load-data, include=FALSE}
superbowl <- readr::read_csv(
  'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-02/youtube.csv')
```

```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "img/darksuperbowl.jpg"
)
```

class: inverse, middle, center

background-image: url(img/superbowlads.jpg)

---

## 1. What factors contribute to the most viewed ads and has the relationship between those factors and the views changed over time?

--

- Talk about specific categories here

---

## Details

You can use plain text

- or bullet points

.pull-left[
or text in two columns $^*$
]
.pull-right[
- like
- this
]

.footnote[
[*] And add footnotes
]

---

## First Plot Name

```{r boring-regression}
# a boring regression
model <- lm(dist ~ speed, data = cars)
tidy(model)
glance(model)
```


---

## 2. What is the relationship between popularity of a Superbowl Ad and how well it is interacted with?

--

- Examining the relationship between different popularity and interaction metrics

--

- Popularity: views
- Interactions: comments, likes, and dislikes

---

```{r density_analysis, echo = FALSE, warning = FALSE, message = FALSE}
superbowl <- superbowl %>%
  mutate(ratio = like_count / (like_count + dislike_count),
         interactions = like_count + dislike_count + comment_count,
         view_category = case_when(
            view_count < 4000 ~ "Few",
            view_count >= 4000 & view_count < 30000 ~ "Some",
            view_count >= 30000 & view_count < 90000 ~ "Medium",
            view_count >= 90000 & view_count < 500000 ~ "Many",
            view_count >= 500000 & view_count < 10000000 ~ "High",
            TRUE ~ "Viral"))
superbowl %>%
  mutate(Views = fct_rev(fct_relevel(
            view_category, "Viral", "High", "Many", "Medium","Some","Few")
         )) %>%
  ggplot(aes(x = ratio, y = Views, fill = Views)) +
    geom_density_ridges(scale = 1, show.legend = TRUE) +
    coord_cartesian(xlim = c(0.5, 1.0)) +
    scale_fill_discrete_sequential(palette = "Greens", order = c(6:1),
                                  labels = c("10M+", "500k to 10M", 
                                            "90K to 500K", "30K to 90K", 
                                            "4k to 30K", "Less than 4K")) +
    scale_x_continuous(expand = c(0, 0.1), labels = scales::percent_format(accuracy = 1)) +
    scale_y_discrete(expand = expand_scale(mult = c(0, .3))) +
    labs(
      title = "Youtube Superbowl Ads and Like Percentages",
      x = "Like Percentage",
      y = "Views",
    caption = "Source: FiveThirtyEight") +
    guides(fill = guide_legend()) +
    theme_ridges() +
    theme(
      plot.title.position = "plot",
      plot.title = element_text(face = "bold", size = 90, hjust = 0),
      plot.caption = element_text(size = 40, hjust = 1.3),
      legend.key.size = unit(3, 'cm'),
      legend.text = element_text(size = 40),
      legend.title = element_text(size = 50),
      axis.title.x = element_text(face = "bold", size = 70, hjust = 0.42, vjust = -1), 
      axis.title.y = element_text(face = "bold", size = 70, hjust = 0.45, vjust = 1),
      axis.text = element_text(size = 50, lineheight = 10),
      axis.text.x = element_text(vjust = -1))
```

---
```{r set_views, echo = FALSE, message = FALSE, warning = FALSE}
superbowl <- superbowl %>%
  mutate(view_category = paste(view_category, "Views"))
superbowl <- superbowl %>%
  mutate(view_category = fct_relevel(
  view_category, "Few Views","Many Views","Some Views","High Views", "Medium Views", "Viral Views"))
```

```{r interactions, echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data = superbowl, aes(x = view_count, y = interactions)) +
  geom_point(aes(fill = view_category), show.legend = NULL) +
  geom_smooth(method = "lm", se = F) +
  #geom_line() +
  facet_wrap(vars(view_category),  
             scales ="free",
             nrow = 3,
             strip.position = "top") +
	scale_y_continuous(label = label_number_si()) +
  scale_x_continuous(label = label_number_si()) +
  scale_fill_discrete_sequential(palette = "Blues") +
  labs(x = "View Count", y ="Number of Interactions", title ="Assessing Superbowl Ad Interactions",
       caption ="Interaction is defined by the sum of \nlikes, dislikes and comments on a video")+
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        strip.background = element_rect(colour = "black"),
        strip.placement = "inside",
        plot.title = element_text(face = "bold", size = 80, hjust = 0.5, vjust = 1),
        plot.caption = element_text(size = 30, hjust = 0),
        panel.spacing = unit(1.4, "lines"),
        axis.text.x = NULL,
        axis.title.x = element_text(size = 50, vjust = -.5),
        axis.title.y = element_text(size = 50, hjust = 0.5, vjust = 1),
        axis.text = element_text(size = 25, lineheight = 10),
        strip.text.x = element_text(size = 30))
```
---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger

```
]

---

class: inverse, middle, center

# A new section...

---

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r penguins-table, echo = FALSE}

```

---

## Images

```{r castle, echo = FALSE, out.width = "40%", fig.align = "center", fig.cap = "Image credit: Danielle Navarro, Percolate."}
include_graphics("img/watercolour_sys02_img32_percolate.jpg")
```

Or you can also include a full page image. See next slide.

---

background-image: url(img/watercolour_sys02_img32_percolate.jpg)

---

## Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

```{r message=FALSE, echo=FALSE, clean-and-transform-data}
#message related to grouping by 'brand' and 'year' in summarise, which is what we want
superbowl_viz <- superbowl %>%
  select(year, brand, animals, celebrity, use_sex, 
         funny, show_product_quickly, patriotic, danger) %>%
  pivot_longer(cols = c(animals, celebrity, use_sex, funny, 
                        show_product_quickly, patriotic, danger), 
               names_to = 'ad_type', 
               values_to = 'have') %>%
  filter(have == TRUE) %>%
  group_by(brand, year, ad_type) %>%
  summarise(ads = n()) %>%
  mutate(brand = case_when(brand == 'Hynudai' ~ 'Hyundai',
                           TRUE ~ as.character(brand))) %>%
  mutate(category = case_when(brand == 'Bud Light' ~ 'Alcohol',
                          brand == 'Budweiser' ~ 'Alcohol',
                          brand == 'Doritos' ~ 'Food & Beverage',
                          brand == 'Pepsi' ~ 'Food & Beverage',
                          brand == 'Coca-Cola' ~ 'Food & Beverage',
                          brand == 'Hyundai' ~ 'Automobile',
                          brand == 'Toyota' ~ 'Automobile',
                          brand == 'Kia' ~ 'Automobile',
                          brand == 'E-Trade' ~ 'Financial Services',
                          brand == 'NFL' ~ 'Sports')) %>%
  relocate(year, .before = brand) %>%
  relocate(category, .before = brand)
```

```{r echo=FALSE, brand-totals-label}
brand_totals <- superbowl_viz %>%
  filter(ad_type != 'celebrity',
         ad_type != 'use_sex',
         ad_type != 'danger',
         ad_type != 'patriotic') %>%
  group_by(brand)  %>%
  summarise(brand_totals = n())
```

```{r message=FALSE, echo=FALSE, Q1-Plot-1-Brand}
#message related to grouping in summarise(), which is how we want it
brand_viz <- superbowl_viz %>%
  filter(ad_type != 'celebrity',
         ad_type != 'use_sex',
         ad_type != 'danger',
         ad_type != 'patriotic') %>%
  group_by(brand, ad_type)  %>%
  summarise (ads = n()) %>% 
  ggplot(aes(factor(brand, levels = c("Bud Light", "Budweiser", "Doritos", 
                                      "Pepsi", "Coca-Cola", "Hyundai",
                                      "E-Trade", "Toyota", "Kia",
                                      "NFL")), 
             ads, 
             fill = ad_type)) +
  geom_bar(stat = "identity", 
           position = position_stack(0.1)) +
  geom_text(data = brand_totals, 
           aes(x = brand, y = brand_totals, 
               label = brand_totals, 
               fontface = 3,
               fill = NULL), 
           size = 10,
           nudge_y = 2) +
  scale_y_continuous(breaks = seq(0, 60, 10)) + 
  #scale_x_discrete(expand = c(.1,0)) +
  #facet_grid(. ~ brand, scales = "free_x") +
  scale_fill_manual(values = c("#56B4E9", "#E69F00", "#009E73"), 
                     labels = c("Shows Product Quickly", "Funny", "Animals")) +
  labs(title = "Ad Occurrences by Brand",
       y = "Ad Occurrences", 
       x = "Brand",
       fill = "Ad Type",
       caption = "Source: FiveThirtyEight") +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", 
                                  size = 80, 
                                  hjust = 0.5, vjust = 1),
        plot.caption = element_text(size = 30, hjust = 1.55),
        legend.position = c(0.85, 0.7),
        axis.text.x = element_blank(),
        strip.text = element_blank(),
        axis.title.y = element_text(vjust = 1, 
                                    size = 50),
        axis.text.y = element_text(hjust = 1.75),
        axis.title.x = element_text(vjust = -2,
                                    size = 50),
        axis.text = element_text(size = 25, 
                                 lineheight = 10),
        legend.title = element_text(size = 50),
        legend.text = element_text(size = 40))

images <- axis_canvas(brand_viz, axis = 'x') + 
  draw_image("https://1000logos.net/wp-content/uploads/2021/04/Bud-Light-logo-768x432.png", 
             x = 0.5, scale = 0.75) +
  draw_image("https://logos-world.net/wp-content/uploads/2020/12/Budweiser-Logo-2016-present.jpg", 
             x = 1.5, scale = 1.1) +
  draw_image("https://1000logos.net/wp-content/uploads/2020/07/Doritos-Logo-768x480.png",
             x = 2.5, scale = 1.1) +
  draw_image("https://1000logos.net/wp-content/uploads/2017/05/Pepsi-Logo-768x631.png", 
             x = 3.5, scale = 0.9) +
  draw_image("https://1000logos.net/wp-content/uploads/2021/05/Coca-Cola-logo-768x432.png",
             x = 4.5, scale = 1) +
  draw_image("https://1000logos.net/wp-content/uploads/2018/04/Hyundai-logo-768x432.png",
             x = 5.5, scale = 1.1) +
  draw_image("https://res.cloudinary.com/crunchbase-production/image/upload/c_lpad,h_256,w_256,f_auto,q_auto:eco,dpr_1/v1476500866/ukg833gylj7adlryeuig.png", 
             x = 6.5, scale = 1) +
  draw_image("https://1000logos.net/wp-content/uploads/2021/04/Toyota-logo-768x432.png", 
             x = 7.5, scale = 0.8) +
  draw_image("https://1000logos.net/wp-content/uploads/2020/02/Kia-Logo-2012-1024x635.jpg", 
             x = 8.5, scale = 0.9) +
  draw_image("https://1000logos.net/wp-content/uploads/2017/05/NFL-logo-768x518.png", 
             x = 9.5, scale = 1.1) 

ggdraw(insert_xaxis_grob(brand_viz, images, position = "bottom"))
```


---



```{r message=FALSE, echo=FALSE, ad-labels}
#message related to grouping in summarise(), which is how we want it
ad_labels <- superbowl %>%
  pivot_longer(cols = c(animals, celebrity, use_sex, funny, 
                        show_product_quickly, patriotic, danger), 
               names_to = 'ad_type', 
               values_to = 'have') %>%
  filter(have == TRUE,
         ad_type != 'celebrity',
         ad_type != 'use_sex',
         ad_type != 'danger',
         ad_type != 'patriotic') %>%
  group_by(ad_type, year) %>%
  summarise(ads = n()) %>%
  filter(year == 2005) %>%
  mutate(ads = case_when(ads == 6 ~ 4.1,
                         ads == 11 ~ 9.9,
                         ads == 8 ~ 8.5))

```


```{r message=FALSE, echo=FALSE, Q1-Plot-2}
#message related to geom_smooth() method and formula, 
#which are both what we want
superbowl %>%
  pivot_longer(cols = c(animals, celebrity, use_sex, funny, 
                        show_product_quickly, patriotic, danger), 
               names_to = 'ad_type', 
               values_to = 'have') %>%
  filter(have == TRUE,
         ad_type != 'celebrity',
         ad_type != 'use_sex',
         ad_type != 'danger',
         ad_type != 'patriotic') %>%
  group_by(year, ad_type) %>%
  summarise(ads = n()) %>%
  ggplot(aes(year, ads, color = ad_type)) + 
  geom_line(aes(linetype = ad_type), 
            stat = "smooth",
            size = 12, 
            se = F,
            show.legend = FALSE) +
  geom_text_repel(data = ad_labels, 
                  aes(label = c("Shows Product Quickly", "Funny", "Animals")),
                  nudge_x = 0.25,
                  nudge_y = -0.8,
                  size = 15,
                  show.legend = FALSE) +
  scale_color_manual(values = c("#56B4E9", "#E69F00", "#009E73"), 
                     labels = c("Shows Product Quickly", "Funny", "Animals"),
                     guide = guide_legend(reverse = TRUE)) +
  scale_y_continuous(breaks = seq(0, 13, 2)) +
  scale_x_continuous(breaks = seq(2000, 2020, 4)) +
  theme_minimal() + 
  theme(plot.title = element_text(face = "bold", 
                                  size = 80, 
                                  hjust = 0.5, vjust = 1),
        plot.subtitle = element_text(size = 60, 
                                  hjust = 0.5, vjust = 1),
        plot.caption = element_text(size = 30, hjust = 1.55),
        axis.title.x = element_text(vjust = -2, 
                                    size = 50),
        axis.title.y = element_text(vjust = 1, 
                                    size = 50),
        axis.text = element_text(size = 30, 
                                 lineheight = 10)) +
  labs(y = "Ad Occurrences", 
       x = "Year",
       color = "Ad Type",
       caption = "Source: FiveThirtyEight",
       title =  "Ad Occurrences by Type",
       subtitle = "From 2000 - 2020") 
```



---

## Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
