---
title: "Question 1 Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r create-superbowl-viz-data}
#transformed dataset that can be used to make visualizations
# superbowl_viz_data <- superbowl %>%
#   select(year, view_count, animals, celebrity, use_sex) %>%
#   group_by(animals, year) %>%
#   mutate(average_view_count_animals = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   group_by(celebrity, year) %>%
#   mutate(average_view_count_celebrity = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   group_by(use_sex, year) %>%
#   mutate(average_view_count_use_sex = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   select(-view_count) %>%
#   select(year, animals, average_view_count_animals,
#          celebrity, average_view_count_celebrity,
#          use_sex, average_view_count_use_sex)
# 
# superbowl_viz_data <- superbowl_viz_data[!duplicated(superbowl_viz_data), ]
# 
# superbowl_plot <- superbowl_viz_data %>%
#   mutate(avg_vc_ani_TRUE
#          = case_when(animals == TRUE ~ average_view_count_animals)) %>%
#   mutate(avg_vc_ani_FALSE
#          = case_when(animals == FALSE ~ average_view_count_animals)) %>%
#   mutate(avg_vc_cel_TRUE
#          = case_when(celebrity == TRUE ~ average_view_count_celebrity)) %>%
#   mutate(avg_vc_cel_FALSE
#          = case_when(celebrity == FALSE ~ average_view_count_celebrity)) %>%
#   mutate(avg_vc_sex_TRUE
#          = case_when(use_sex == TRUE ~ average_view_count_use_sex)) %>%
#   mutate(avg_vc_sex_FALSE
#          = case_when(use_sex == FALSE ~ average_view_count_use_sex)) %>%
#   select(year, avg_vc_ani_TRUE, avg_vc_ani_FALSE,
#                avg_vc_cel_TRUE, avg_vc_cel_FALSE,
#                avg_vc_sex_TRUE, avg_vc_sex_FALSE)
# 
# superbowl_plot_long <- melt(superbowl_plot, id = "year",
#                            measure = c("avg_vc_ani_TRUE", "avg_vc_ani_FALSE",
#                                        "avg_vc_cel_TRUE", "avg_vc_cel_FALSE",
#                                        "avg_vc_sex_TRUE", "avg_vc_sex_FALSE"))
# 
# superbowl_plot_long <- superbowl_plot_long[!duplicated(superbowl_plot_long), ]
# superbowl_plot_long <- superbowl_plot_long %>%
#   na.omit() %>%
#   filter(value != 0)
```

```{r}
# superbowl_animals <- superbowl %>%
#   select(view_count, animals, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(animals, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_animals <- superbowl_animals[!duplicated(superbowl_animals), ]
# superbowl_animals<- rename(superbowl_animals, 'have' = 'animals')
# superbowl_animals$variable <- 'animals'
# 
# 
# superbowl_celebrity <- superbowl %>%
#   select(view_count, celebrity, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(celebrity, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_celebrity <- superbowl_celebrity[!duplicated(superbowl_celebrity), ]
# superbowl_celebrity<- rename(superbowl_celebrity, 'have' = 'celebrity')
# superbowl_celebrity$variable <- 'celebrity'
# 
# 
# superbowl_use_sex <- superbowl %>%
#   select(view_count, use_sex, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(use_sex, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_use_sex <- superbowl_use_sex[!duplicated(superbowl_use_sex), ]
# superbowl_use_sex<- rename(superbowl_use_sex, 'have' = 'use_sex')
# superbowl_use_sex$variable <- 'use_sex'
# 
# superbowl_viz <- rbind(superbowl_animals, superbowl_celebrity, superbowl_use_sex)
# superbowl_viz <- superbowl_viz %>% relocate(variable, .before = have)
```

```{r load-data, include=FALSE}
superbowl <- readr::read_csv(
  'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-02/youtube.csv')
```


```{r}
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(ggeasy)
```



```{r}
superbowl %>%
   select(year, brand, animals, celebrity, use_sex, funny, show_product_quickly, patriotic, danger) %>%
   pivot_longer(cols = c(animals, celebrity, use_sex, funny, show_product_quickly, patriotic, danger), 
                names_to = 'variable', 
               values_to = 'have') %>%
   filter(have == TRUE) %>%
   group_by(variable) %>%
   summarise(x = n())
 
```



```{r message=FALSE, clean-and-transform-data}
#message related to grouping by 'brand' and 'year' in summarise, which is what we want
superbowl_viz <- superbowl %>%
  select(year, brand, animals, celebrity, use_sex, funny, show_product_quickly, patriotic, danger) %>%
  pivot_longer(cols = c(animals, celebrity, use_sex, funny, show_product_quickly, patriotic, danger), 
               names_to = 'variable', 
               values_to = 'have') %>%
  filter(have == TRUE) %>%
  group_by(brand, year, variable) %>%
  summarise(x = n()) %>%
  relocate(year, .before = brand) 
```



```{r Q1-plot-1}
superbowl_viz %>%
  select(-year) %>%
  group_by(variable, have)  %>%
  summarise (aggregate_vc = sum(total_vc),
            aggregate_ads = n(),
            average_vc = aggregate_vc / aggregate_ads) %>% 
  relocate(average_vc, .before = aggregate_vc) %>%
  ggplot(aes(brand, average_vc, fill = variable)) +
  geom_bar(stat = "identity", position = "dodge") + 
  scale_fill_manual(values = c("red", "blue"), 
                    guide = guide_legend(reverse = TRUE)) + 
  scale_y_continuous(labels = comma) +
  labs(title = "Advertisement Views by Category",
       x = "Category", y = "Average View Count") +
  theme_minimal() +
  easy_center_title()
```



## Plots (Q1 Plot 2)

```{r}
superbowl_viz %>%
ggplot(aes(year, total_vc, color = brand)) + 
  geom_point() + 
  coord_cartesian(ylim  = c(0, 2e+08)) + 
  theme_minimal() + 
  labs(y = "Total View Count", 
       x = "Year",
       color = "Ad Type") 
```


















