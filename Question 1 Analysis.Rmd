---
title: "Question 1 Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r create-superbowl-viz-data}
#transformed dataset that can be used to make visualizations
# superbowl_viz_data <- superbowl %>%
#   select(year, view_count, animals, celebrity, use_sex) %>%
#   group_by(animals, year) %>%
#   mutate(average_view_count_animals = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   group_by(celebrity, year) %>%
#   mutate(average_view_count_celebrity = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   group_by(use_sex, year) %>%
#   mutate(average_view_count_use_sex = sum(view_count, na.rm = TRUE) / n()) %>%
#   ungroup() %>%
#   select(-view_count) %>%
#   select(year, animals, average_view_count_animals,
#          celebrity, average_view_count_celebrity,
#          use_sex, average_view_count_use_sex)
# 
# superbowl_viz_data <- superbowl_viz_data[!duplicated(superbowl_viz_data), ]
# 
# superbowl_plot <- superbowl_viz_data %>%
#   mutate(avg_vc_ani_TRUE
#          = case_when(animals == TRUE ~ average_view_count_animals)) %>%
#   mutate(avg_vc_ani_FALSE
#          = case_when(animals == FALSE ~ average_view_count_animals)) %>%
#   mutate(avg_vc_cel_TRUE
#          = case_when(celebrity == TRUE ~ average_view_count_celebrity)) %>%
#   mutate(avg_vc_cel_FALSE
#          = case_when(celebrity == FALSE ~ average_view_count_celebrity)) %>%
#   mutate(avg_vc_sex_TRUE
#          = case_when(use_sex == TRUE ~ average_view_count_use_sex)) %>%
#   mutate(avg_vc_sex_FALSE
#          = case_when(use_sex == FALSE ~ average_view_count_use_sex)) %>%
#   select(year, avg_vc_ani_TRUE, avg_vc_ani_FALSE,
#                avg_vc_cel_TRUE, avg_vc_cel_FALSE,
#                avg_vc_sex_TRUE, avg_vc_sex_FALSE)
# 
# superbowl_plot_long <- melt(superbowl_plot, id = "year",
#                            measure = c("avg_vc_ani_TRUE", "avg_vc_ani_FALSE",
#                                        "avg_vc_cel_TRUE", "avg_vc_cel_FALSE",
#                                        "avg_vc_sex_TRUE", "avg_vc_sex_FALSE"))
# 
# superbowl_plot_long <- superbowl_plot_long[!duplicated(superbowl_plot_long), ]
# superbowl_plot_long <- superbowl_plot_long %>%
#   na.omit() %>%
#   filter(value != 0)
```

```{r}
# superbowl_animals <- superbowl %>%
#   select(view_count, animals, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(animals, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_animals <- superbowl_animals[!duplicated(superbowl_animals), ]
# superbowl_animals<- rename(superbowl_animals, 'have' = 'animals')
# superbowl_animals$variable <- 'animals'
# 
# 
# superbowl_celebrity <- superbowl %>%
#   select(view_count, celebrity, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(celebrity, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_celebrity <- superbowl_celebrity[!duplicated(superbowl_celebrity), ]
# superbowl_celebrity<- rename(superbowl_celebrity, 'have' = 'celebrity')
# superbowl_celebrity$variable <- 'celebrity'
# 
# 
# superbowl_use_sex <- superbowl %>%
#   select(view_count, use_sex, year) %>%
#   filter(!is.na(view_count)) %>%
#   group_by(use_sex, year) %>%
#   mutate(average_view_count = sum(view_count) / n(),
#          total_view_count = sum(view_count),
#          total_ads = n())%>%
#   ungroup() %>%
#   select(-view_count)
# 
# superbowl_use_sex <- superbowl_use_sex[!duplicated(superbowl_use_sex), ]
# superbowl_use_sex<- rename(superbowl_use_sex, 'have' = 'use_sex')
# superbowl_use_sex$variable <- 'use_sex'
# 
# superbowl_viz <- rbind(superbowl_animals, superbowl_celebrity, superbowl_use_sex)
# superbowl_viz <- superbowl_viz %>% relocate(variable, .before = have)
```

```{r load-data, include=FALSE}
superbowl <- readr::read_csv(
  'https://raw.githubusercontent.com/rfordatascience/tidytuesday/
   master/data/2021/2021-03-02/youtube.csv')
```


```{r}
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
```



```{r}
testing <- superbowl %>%
   select(year, brand, animals, celebrity, use_sex, 
          funny, show_product_quickly, patriotic, danger) %>%
   pivot_longer(cols = c(animals, celebrity, use_sex, funny, 
                         show_product_quickly, patriotic, danger), 
                names_to = 'variable', 
                values_to = 'have') %>%
   filter(have == TRUE) %>%
   group_by(variable) %>%
   summarise(x = n()) 
```



```{r message=FALSE, clean-and-transform-data}
#message related to grouping by 'brand' and 'year' in summarise, which is what we want
superbowl_viz <- superbowl %>%
  select(year, brand, animals, celebrity, use_sex, 
         funny, show_product_quickly, patriotic, danger) %>%
  pivot_longer(cols = c(animals, celebrity, use_sex, funny, 
                        show_product_quickly, patriotic, danger), 
               names_to = 'variable', 
               values_to = 'have') %>%
  filter(have == TRUE) %>%
  group_by(brand, year, variable) %>%
  summarise(ads = n()) %>%
  relocate(year, .before = brand) 
```





```{r Q1-Plot1}
superbowl_viz %>%
  group_by(brand, variable)  %>%
  summarise (ads = n()) %>% 
  ggplot(aes(ads, brand, fill = variable, label = ads)) +
  geom_bar(stat = "identity") + 
  geom_text(size = 2.5, position = position_stack(vjust = 0.5)) +
  scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73", 
                               "#F0E442", "#0072B2", 
                               "#D55E00", "#CC79A7"),
                    labels = c("Sexual", "Show Product Quickly", "Patriotic", 
                               "Funny", "Danger", 
                               "Celebrity", "Animal"))+
  labs(title = "Ad Occurences by Brand",
       x = "Ad Occurences", y = "Brand",
       fill = "Ad Type",
       caption = "Source: FiveThirtyEight") +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 1.55)) 
```




## Plots (Q1 Plot 2)

```{r}
superbowl_viz %>%
ggplot(aes(year, ads, color = variable)) + 
  #geom_point(size = 1) + 
  geom_line(stat = "smooth", size = 1.5, se=F, alpha = .75) +
  scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73", 
                                "#F0E442","#0072B2",
                                "#D55E00", "#CC79A7"), 
                     labels = c("Sexual", "Show Product Quickly", "Patriotic", 
                                "Funny", "Danger", 
                                "Celebrity", "Animal"),
                     guide = guide_legend(reverse = TRUE)) +
  scale_y_continuous(breaks = seq(0, 3, 0.5)) +
 # facet_wrap(vars(variable), 4, 2) +
  theme_minimal() + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 1.48)) +
  labs(y = "Total View Count", 
       x = "Year",
       color = "Ad Type",
       caption = "Source: FiveThirtyEight",
       title =  "is this occurances by type??? y axis unclear") 
```


















